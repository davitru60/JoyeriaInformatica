(()=>{"use strict";const o="http://127.0.0.1:8000/api/";document.addEventListener("DOMContentLoaded",(function(){!async function(){const e=await async function(){const e=o;try{const o=await fetch(e+"lotesNoClasificados");if(o.ok)return(await o.json()).lotes;console.log("Algo fue mal")}catch(o){}}(),t=await async function(){const e=o;try{const o=await fetch(e+"componente");if(o.ok)return(await o.json()).componente;console.log("Algo fue mal")}catch(o){console.error("Error al obtener los componentes:",o)}}(),n=$("#loteEntregado").DataTable();n.clear().draw(),e.forEach((e=>{const a=t.map((o=>`<option value="${o.id_comp}">${o.nombre}</option>`)).join(""),s=n.row.add([e.id_lote,e.latitud,e.longitud,e.estado,`<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#myModal${e.id_lote}"><i class="fas fa-edit"></i> Clasificar</button><button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAgregar${e.id_lote}"><i class="fas fa-plus"></i> Despiezar</button>`]).draw(),d=`\n                <div class="modal" id="myModal${e.id_lote}">\n                    <div class="modal-dialog modal-md">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h4 class="modal-title">Modificar estado del lote</h4>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                            </div>\n                            <div class="modal-body">\n                                <form>\n                                    <div class="mb-3">\n                                        <label for="ubicacion" class="form-label">ID Lote:</label>\n                                        <input type="text" class="form-control" id="ubicacion" value="${e.id_lote}" readonly>\n                                    </div>\n\n                                    <div class="mb-3">\n                                    <label for="hwDropdown" class="form-label">Modificar el estado</label>\n                                    <select class="form-select" id="estadoDropdown" required>\n                                        <option>Clasificado</option>\n                                    </select>\n                                </div>\n                                </form>\n                            </div>\n                            <div class="modal-footer">\n                            <button type="button" class="btn btn-primary"  data-bs-dismiss="modal" id="modificarLoteBtn${e.id_lote}">Modificar</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `,l=`\n                <div class="modal" id="modalAgregar${e.id_lote}">\n                    <div class="modal-dialog modal-md">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h4 class="modal-title">Agregar componente de despiece</h4>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                            </div>\n                            <div class="modal-body">\n                                <form>\n                                    <div class="mb-3">\n                                        <label for="numLote" class="form-label">Numero lote:</label>\n                                        <input type="text" class="form-control" id="numLote" value="${e.id_lote}" readonly>\n                                    </div>\n                                    <div class="mb-3">\n                                        <label for="compDropdown" class="form-label">Componente</label>\n                                        <select class="form-select" id="compDropdown" required>\n                                            ${a}\n                                        </select>\n                                    </div>\n                                    <div class="mb-3">\n                                        <label for="cantidad" class="form-label">Cantidad:</label>\n                                        <input type="text" class="form-control" id="cantidad">\n                                    </div>\n\n                                    <div class="mb-3">\n                                        <label for="descripcion" class="form-label">Descripcion:</label>\n                                        <input type="text" class="form-control" id="descripcion">\n                                    </div>\n                                </form>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-success" data-bs-dismiss="modal" id="agregarDespiece${e.id_lote}" >Agregar</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;document.body.insertAdjacentHTML("beforeend",d),document.body.insertAdjacentHTML("beforeend",l),s.nodes().to$().data("lote",e),async function(e){document.getElementById(`modificarLoteBtn${e}`).addEventListener("click",(async()=>{const t=document.getElementById(`myModal${e}`),n=t.querySelector("#estadoDropdown"),a={estado:n.options[n.selectedIndex].value};await async function(e,t){const n=o;try{const o=sessionStorage.getItem("token"),a=await fetch(n+"despiece/"+e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},body:JSON.stringify(t)});if(a.ok){const o=await a.json();console.log("Lote clasificado correctamente:",o)}else console.error("Error al clasificar")}catch(o){}}(e,a),new bootstrap.Modal(t).hide()}))}(e.id_lote),async function(e){document.getElementById(`agregarDespiece${e}`).addEventListener("click",(async()=>{const t=document.getElementById(`modalAgregar${e}`),n=t.querySelector("#compDropdown");var a={id_comp:n.options[n.selectedIndex].value,cantidad:t.querySelector("#cantidad").value,descripcion:t.querySelector("#descripcion").value};console.log(a),await async function(e,t){const n=o,a=sessionStorage.getItem("token");try{const o=await fetch(n+"despiece/"+t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(e)});if(422==o.status){const e=await o.json(),t=new bootstrap.Modal(document.getElementById("errorModal")),n=document.getElementById("errorModalBody"),a=e.error.map((o=>`- ${o}`)).join("\n");n.innerText=a,t.show()}else{const o=new bootstrap.Modal(document.getElementById("successModal"));document.getElementById("successModalBody").innerText="El componente se ha aÃ±adido con exito ",o.show(),setTimeout((()=>{o.hide()}),1500)}}catch(o){}}(a,e),window.location.href="clasificacionLote.html",new bootstrap.Modal(t).hide(),t.querySelector("#cantidad").value="",t.querySelector("#descripcion").value=""}))}(e.id_lote)}))}()}))})();