(()=>{"use strict";const t="http://127.0.0.1:8000/api/";document.addEventListener("DOMContentLoaded",(function(){!async function(){const e=await async function(){const e=t,n=sessionStorage.getItem("token");try{const t=await fetch(e+"joya",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}});if(!t.ok)throw new Error(`Error al obtener la lista de joya. Código de estado: ${t.status}`);return(await t.json()).joya}catch(t){console.error("Error en la función monstrarJoya:",t.message)}}(),n=document.querySelector("#joyaDeseada");n.addEventListener("change",(async()=>{const e=n.value;if(e){const n=await async function(e){const n=t,a=sessionStorage.getItem("token");try{const t=await fetch(n+"ingredientes/"+e,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+a}});if(t.ok)return await t.json()}catch(t){}}(e);!async function(e){const n=document.getElementById("disponibilidad"),a=document.getElementById("cantidadesTexto"),o=(await async function(e){const n=t,a=sessionStorage.getItem("token");try{const t=await fetch(n+"verificarComponentes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(e)});if(t.ok)return await t.json()}catch(t){}}(e)).map((t=>`<p class="card-text ms-2">- Disponibilidad de ${t.nombre}: ${t.cantDisponible} unidades</p>`)).join("");n.innerHTML=o;const s=await async function(e){const n=t,a=sessionStorage.getItem("token");try{const t=await fetch(n+"calcular",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(e)});if(t.ok)return await t.json()}catch(t){}}(e);a.textContent=`- Se pueden fabricar ${s.cantidad_maxima_joyas} joyas de este tipo`}(n),async function(e){document.getElementById("fabricarBtn").addEventListener("click",(async()=>{await async function(e){const n=t,a=sessionStorage.getItem("token");try{const t=await fetch(n+"fabricar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(e)}),o=await t.json();document.querySelectorAll(".alert").forEach((t=>t.remove()));const s=document.createElement("div");s.classList.add("alert","mt-3"),t.ok?(s.classList.add("alert-success"),s.textContent=`Éxito: ${o.mensaje}`):400===t.status?(s.classList.add("alert-danger"),s.textContent=`Error : ${o.mensaje}`):(s.classList.add("alert-danger"),s.textContent=`Error en la solicitud: ${o.mensaje}`),filaFabrica.insertBefore(s,filaFabrica.firstChild),setTimeout((()=>{s.remove()}),2e3)}catch(t){console.error("Error en la solicitud:",t)}}(e)}))}(n)}})),e.forEach((t=>{const e=document.createElement("option");e.value=t.id_joya,e.text=t.nombre,n.add(e)}))}()}))})();