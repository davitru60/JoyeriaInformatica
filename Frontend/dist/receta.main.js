(()=>{"use strict";const e="http://127.0.0.1:8000/api/";document.addEventListener("DOMContentLoaded",(function(){!async function(){const t=await async function(){const t=e,a=sessionStorage.getItem("token");try{const e=await fetch(t+"recetas",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a}});if(!e.ok)throw new Error(`Error al obtener la lista de recetas. Código de estado: ${e.status}`);return(await e.json()).receta}catch(e){throw console.error("Error en la función monstrarRecetas:",e.message),e}}();console.log(t);const a=$("#recetas").DataTable();a.clear().draw(),t.forEach((t=>{const o=a.row.add([t.id_receta,t.id_joya,t.descripcion,`<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#myModal${t.id_receta}"><i class="fas fa-edit"></i> Editar</button><button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal${t.id_receta} " ><i class="fas fa-trash-alt"></i> Borrar</button>`]).draw(),n=`\n            <div class="modal" id="myModal${t.id_receta}">\n                <div class="modal-dialog modal-md">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h4 class="modal-title">Detalles de la receta</h4>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <form>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Número de receta:</label>\n                                    <input type="text" class="form-control" id="id_receta" value="${t.id_receta}" readonly>\n                                </div>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Número de joya:</label>\n                                    <input type="text" class="form-control" id="id_joya" value="${t.id_joya}">\n                                </div>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Descripción:</label>\n                                    <input type="text" class="form-control" id="descripcion" value="${t.descripcion}">\n                                </div>\n                          \n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-success" data-bs-dismiss="modal" id="modificarBtn${t.id_receta}">Modificar</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,s=`\n        <div class="modal" id="deleteModal${t.id_receta}">\n        <div class="modal-dialog modal-md">\n            <div class="modal-content">\n    \n                <div class="modal-header">\n                    <h4 class="modal-title">Confirmar eliminación</h4>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                </div>\n    \n    \n                <div class="modal-body">\n                    <p>¿Estás seguro de que deseas eliminar esta receta?</p>\n                </div>\n    \n                <div class="modal-footer">\n                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="confirmarEliminacionBtn${t.id_receta}">Confirmar eliminación</button>\n                </div>\n    \n            </div>\n        </div>\n    </div>`;document.body.insertAdjacentHTML("beforeend",n),document.body.insertAdjacentHTML("beforeend",s),o.nodes().to$().data("recetas",t),async function(t){const a=document.getElementById(`confirmarEliminacionBtn${t}`);a&&a.addEventListener("click",(async()=>{try{await async function(t){const a=e,o=sessionStorage.getItem("token");try{const e=await fetch(a+"recetas/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}});if(e.ok){const t=await e.json();console.log("recetas eliminado correctamente:",t)}else console.error("No se pudo eliminar el recetas")}catch(e){console.error("Error al eliminar el recetas:",e)}}(t);const a=document.getElementById(`deleteModal${t}`);new bootstrap.Modal(a).hide(),location.reload()}catch(e){console.error("Error al confirmar la eliminación:",e)}}))}(t.id_receta),async function(t){const a=document.getElementById(`modificarBtn${t}`);a&&a.addEventListener("click",(async()=>{try{const a=document.getElementById(`myModal${t}`),o={id_joya:a.querySelector("#id_joya").value,descripcion:a.querySelector("#descripcion").value};await async function(t,a){const o=e,n=sessionStorage.getItem("token");try{const e=await fetch(o+"recetas/"+t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify(a)});if(e.ok){const t=await e.json();console.log("recetas modificado correctamente:",t)}else console.error("No se pudo modificar el recetas")}catch(e){}}(t,o),new bootstrap.Modal(a).hide(),location.reload()}catch(e){console.error("Error al confirmar la modificación:",e)}}))}(t.id_receta)}))}()}))})();