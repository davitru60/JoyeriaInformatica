(()=>{"use strict";const a="http://127.0.0.1:8000/api/";document.addEventListener("DOMContentLoaded",(function(){!async function(){const n=await async function(){const n=a+"usuarios";try{const a=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Error al obtener la lista de usuarios. Código de estado: ${a.status}`);return(await a.json()).usuarios}catch(a){throw console.error("Error en la función monstrarUsuario:",a.message),a}}(),o=$("#usuarios").DataTable();o.clear().draw(),n.forEach((n=>{const e=o.row.add([n.foto,n.nombre,n.ape1,n.ape2,n.email,`<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#myModal${n.id}"><i class="fas fa-edit"></i> Editar</button><button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal${n.id}" ><i class="fas fa-trash-alt"></i> Eliminar</button>`]).draw(),t=`\n<div class="modal" id="myModal${n.id}">\n    <div class="modal-dialog modal-md">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">Editar usuario ${n.nombre}</h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n            </div>\n            <div class="modal-body">\n                <div class="row">\n                <div class="col-sm-12 col-md-6 col-lg-6">\n                    <label for="nombre" class="form-label">Nombre</label>\n                    <input type="text" id="nombre${n.id}" name="nombre${n.id}" class="form-control" value=${n.nombre}>\n                    <div class="invalid-feedback" id="mensajeNombre"></div>\n                </div>\n\n                <div class="col-sm-12 col-md-6 col-lg-6">\n                    <label for="ap1" class="form-label">Primer apellido</label>\n                    <input type="text" id="ap1${n.id}" name="ap1${n.id}" class="form-control" value=${n.ape1}>\n                    <div class="invalid-feedback" id="mensajeAp1"></div>\n                </div>\n\n                <div class="col-sm-12 col-md-6 col-lg-6">\n                    <label for="ap2" class="form-label">Segundo apellido</label>\n                    <input type="text" id="ap2${n.id}" name="ap2${n.id}" class="form-control" value=${n.ape2}>\n                    <div class="invalid-feedback" id="mensajeAp2"></div>\n                </div>\n\n                <div class="col-sm-12 col-md-6 col-lg-6">\n                    <label for="email" class="form-label">Email</label>\n                    <input type="text" id="email${n.id}" name="email${n.id}" class="form-control" value=${n.email}>\n                    <div class="invalid-feedback" id="mensajeEmail"></div>\n                </div>\n\n                <div class="col-sm-12 col-md-6 col-lg-6">\n                    <label for="contra" class="form-label">Contraseña</label>\n                    <div class="input-group">\n                        <input type="password" id="contra${n.id}" name="contra${n.id}" class="form-control" value=${n.contrasena}>\n                        <button type="button" class="btn btn-primary" id="btn-contra">\n                        <i class="bi bi-eye-slash-fill" id="eye-icon"></i>\n                        </button>\n                    <div class="invalid-feedback" id="mensajeContrasena"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="editarBtn${n.id}">Editar usuario</button>\n            </div>\n        </div>                \n    </div>\n</div>\n            `,i=`\n        <div class="modal" id="deleteModal${n.id}">\n            <div class="modal-dialog modal-md">\n                <div class="modal-content">\n        \n                    <div class="modal-header">\n                        <h4 class="modal-title">Confirmar Eliminación</h4>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                    </div>\n        \n        \n                    <div class="modal-body">\n                        <p>¿Estás seguro de que deseas eliminar el usuario ${n.nombre} ${n.ape1} ${n.ape2}?</p>\n                    </div>\n        \n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="confirmarEliminacion${n.id}">Confirmar Eliminación</button>\n                    </div>\n        \n                </div>\n            </div>\n        </div>\n            `;document.body.insertAdjacentHTML("beforeend",t),async function(a){const n=document.getElementById(`editarBtn${a}`);n&&n.addEventListener("click",(async()=>{try{const n=document.getElementById(`myModal${a}`),o=n.querySelector(`#nombre${a}`).value,e=n.querySelector(`#ap1${a}`).value,t={nombre:o,ape1:e,ape2:n.querySelector(`#ap2${a}`).value,email:n.querySelector(`#email${a}`).value,contrasena:n.querySelector(`#contra${a}`).value};await async function(a,n){try{const o=await fetch("http://127.0.0.1:8000/api/usuarios/"+a,{method:"PUT",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`Error al eliminar el usuario. Código de estado: ${o.status}`);return await o.json()}catch(a){throw console.error("Error en la función eliminarUsuario:",a.message),a}}(a,t),new bootstrap.Modal(n).hide(),location.reload()}catch(a){console.error("Error al confirmar la modificación:",a)}}))}(n.id),document.body.insertAdjacentHTML("beforeend",i),async function(n){const o=document.getElementById(`confirmarEliminacion${n}`);o&&o.addEventListener("click",(async()=>{try{await async function(n){const o=a+"usuarios/";try{const a=await fetch(o+n,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Error al eliminar el usuario. Código de estado: ${a.status}`);return await a.json()}catch(a){throw console.error("Error en la función eliminarUsuario:",a.message),a}}(n);const o=document.getElementById(`deleteModal${n}`);new bootstrap.Modal(o).hide(),location.reload()}catch(a){console.error("Error al confirmar la eliminación:",a)}}))}(n.id),e.nodes().to$().data("usuarios",n)}));const e=document.getElementById("anadirUsuario");e&&e.addEventListener("click",anadirUsuarioUI)}()}))})();