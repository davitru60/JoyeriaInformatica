(()=>{"use strict";const o="http://127.0.0.1:8000/api/";document.addEventListener("DOMContentLoaded",(function(){!async function(){const a=await async function(){const a=o;try{const o=await fetch(a+"joya",{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Error al obtener la lista de joya. Código de estado: ${o.status}`);return(await o.json()).joya}catch(o){throw console.error("Error en la función monstrarJoya:",o.message),o}}();console.log(a);const n=$("#joyas").DataTable();n.clear().draw(),a.forEach((a=>{const t=n.row.add([a.id_joya,a.nombre,`<img src="../assets/joya/${a.foto}" class="img-fluid" height="100px" width:100%>`,`<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#myModal${a.id_joya}"><i class="fas fa-edit"></i> Editar</button><button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal${a.id_joya} " ><i class="fas fa-trash-alt"></i> Eliminar</button>`]).draw(),e=`\n            <div class="modal" id="myModal${a.id_joya}">\n                <div class="modal-dialog modal-md">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h4 class="modal-title">Detalles de la joya</h4>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <form>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Número de Joyas:</label>\n                                    <input type="text" class="form-control" id="idJoya" value="${a.id_joya}" readonly>\n                                </div>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Nombre:</label>\n                                    <input type="text" class="form-control" id="nombre" value="${a.nombre}">\n                                </div>\n                                <div class="mb-3">\n                                    <label for="ubicacion" class="form-label">Foto:</label>\n                                    <input type="text" class="form-control" id="foto" value="${a.foto}">\n                                </div>\n                          \n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-success" data-bs-dismiss="modal" id="modificarBtn${a.id_joya}">Modificar</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,s=`\n        <div class="modal" id="deleteModal${a.id_joya}">\n        <div class="modal-dialog modal-md">\n            <div class="modal-content">\n    \n                <div class="modal-header">\n                    <h4 class="modal-title">Confirmar eliminación</h4>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                </div>\n    \n    \n                <div class="modal-body">\n                    <p>¿Estás seguro de que deseas eliminar este joya?</p>\n                </div>\n    \n                <div class="modal-footer">\n                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="confirmarEliminacionBtn${a.id_joya}">Confirmar eliminación</button>\n                </div>\n    \n            </div>\n        </div>\n    </div>`;document.body.insertAdjacentHTML("beforeend",e),document.body.insertAdjacentHTML("beforeend",s),t.nodes().to$().data("joyas",a),async function(a){const n=document.getElementById(`confirmarEliminacionBtn${a}`);n&&n.addEventListener("click",(async()=>{try{await async function(a){const n=o;try{const o=await fetch(n+"joya/"+a,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(o.ok){const a=await o.json();console.log("joyas eliminado correctamente:",a)}else console.error("No se pudo eliminar el joyas")}catch(o){console.error("Error al eliminar el joyas:",o)}}(a);const n=document.getElementById(`deleteModal${a}`);new bootstrap.Modal(n).hide(),location.reload()}catch(o){console.error("Error al confirmar la eliminación:",o)}}))}(a.id_joya),async function(a){const n=document.getElementById(`modificarBtn${a}`);n&&n.addEventListener("click",(async()=>{try{const n=document.getElementById(`myModal${a}`),t={nombre:n.querySelector("#nombre").value,foto:n.querySelector("#foto").value};await async function(a,n){const t=o;try{const o=await fetch(t+"joya/"+a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(o.ok){const a=await o.json();console.log("joyas modificado correctamente:",a)}else console.error("No se pudo modificar el joyas")}catch(o){}}(a,t),new bootstrap.Modal(n).hide(),location.reload()}catch(o){console.error("Error al confirmar la modificación:",o)}}))}(a.id_joya)}))}()}))})();